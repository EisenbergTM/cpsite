<!DOCTYPE html>
<html>
{% load staticfiles %}
<link href="{%static "css/bootstrap/bootstrap.min.css" %}" rel="stylesheet" type="text/css" >
<link href="{%static "css/bootstrap/bootstrap-table.css" %}" rel="stylesheet" type="text/css" >
<link href="{%static "css/adstyle.css" %}" rel="stylesheet" type="text/css" />

{% include "header.html" %}
{% include 'menu.html' %}
{% csrf_token %}
<body>
<div class="home">
    <div class="home_right">
        <div class="homepage">
            <div class="pagename"><p>抓取信息列表</p></div>
            <div class="dangqianweizhi"><p>首页 > 爬虫管理系统 > 抓取数据查询</p></div>
        </div>
        <div class="user_hr">
        </div>
        <div class="user_list">
            <div class="user_list_ls">
                <div class="panel panel-default">
                    <div class="panel-heading" >
                        查询条件
                    </div>
                    <div class="panel-body form-group" style="margin-bottom:0px;height: 100%">
                        <li>
                             <label class="col-sm-1 control-label" id="id_label" style="text-align: right; margin-top:10px;">id:</label>
                             <div class="col-sm-4">
                                 <input type="number" class="form-control" name="Name" id="search_id"/>
                             </div>
                             <label class="col-sm-1 control-label" id="third_id_label" style="text-align: right; margin-top:10px;white-space: nowrap">third_id:</label>
                             <div class="col-sm-2">
                                 <input type="text" class="form-control" name="Name" id="search_third_id"/>
                             </div>
                             <label class="col-sm-1 control-label" id="author_label" style="text-align: right; margin-top:10px;white-space: nowrap">作者:</label>
                             <div class="col-sm-2">
                                 <input type="text" class="form-control" name="Name" id="search_author"/>
                             </div>

                             <div class="col-lg-12 url-wrapper"></div>
                             <label class="col-lg-1" id="site_label" style="text-align: center; margin-top:10px;white-space: nowrap">网站名称:</label>
                             <div class="col-lg-2">
                                 <input type="text" class="form-control" name="Name" id="search_name"/>
                             </div>
                            <label class="col-sm-1 control-label" id="channel_label" style="text-align: right; margin-top:10px">频道:</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" name="Name" id="search_channel"/>
                            </div>
                            <label class="col-sm-1 control-label" id="categories_label" style="text-align: right; margin-top:10px;white-space: nowrap">一级分类:</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" name="Name" id="search_category"/>
                            </div>
                            <label class="col-sm-1 control-label" id="sub_category_label" style="text-align: right; margin-top:10px;white-space: nowrap">二级分类:</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" name="Name" id="search_sub_category"/>
                            </div>
                            <div class="col-lg-12 url-wrapper"></div>
                            <label class="col-sm-1 control-label" id="time_gt_label" style="text-align: right; margin-top:10px;white-space: nowrap">开始时间:</label>
                             <div class="col-sm-3">
                                <input type="datetime-local" class="form-control" name="Name" id="search_time_gt" placeholder="%Y-%m-%d %H:%M:%S"/>
                            </div>
                            <label class="col-sm-1 control-label" id="time_lt_label" style="text-align: right; margin-top:10px;white-space: nowrap">结束时间:</label>
                            <div class="col-sm-3">
                                <input type="datetime-local"  class="form-control" name="Name" id="search_time_lt" placeholder="%Y-%m-%d %H:%M:%S"/>
                             </div>
                            <label class="col-sm-1 control-label" id="from_sources_label" style="text-align: right; margin-top:10px">app_id:</label>
                            <div class="col-sm-2">
                                <input type="text" class="form-control" name="Name" id="search_from_sources"/>
                            </div>
                            <div class="col-lg-12 url-wrapper"></div>
                            <label class="col-sm-1 control-label" id="title_label" style="text-align: right; margin-top:10px;white-space: nowrap;">标题:</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" name="Name" id="search_title"/>
                            </div>
                            <div class="col-sm-2">
                                <!--<label class="col-sm-1 control-label" id="type_label" style="text-align: right; margin-top:10px">type：</label>-->
                                <select data-valid="isChecked" class="form-control" data-type="checkbox" id="atype">
                                    <option type="checkbox" name="label" value="0">全部</option>
                                    <option type="checkbox" name="label" value="1">图文</option>
                                    <option type="checkbox" name="label" value="5">音频</option>
                                    <option type="checkbox" name="label" value="3">视频</option>
                                    <option type="checkbox" name="label" value="9">图集</option>
                                </select>
                            </div>
                            <!--<label class="col-sm-1 control-label" id="sort_label" style="text-align: right; margin-top:10px;white-space: nowrap">sort:</label>-->
                            <div class="col-sm-2">
                                <select id="sort" class="form-control">
                                    <option value="desc">正序</option>
                                    <option value="asc">倒序</option>
                                    <option value="no">无序</option>
                                </select>
                            </div>
                            <div class="col-lg-12 url-wrapper"></div>

                            <div class="col-sm-1 col-sm-offset-1">
                                <button class="btn btn-primary" id="search_btn">查询</button>
                            </div>
                         </li>
                     </div>
                </div>

                <table class="table table-hover" id="table"></table>
                <script src="{%static "js/bootstrap/jquery.min.js" %}"></script>
                <script src="{%static "js/bootstrap/bootstrap.min.js" %}"></script>
                <script src="{%static "js/bootstrap/bootstrap-table.js" %}"></script>
                <script src="{%static "js/bootstrap/bootstrap-table-editable.js" %}"></script>
                <script src="{%static "js/bootstrap/bootstrap-table-zh-CN.js" %}"></script>
                <script type="text/javascript">
                    function initTable() {
                        $('#table').bootstrapTable({
                            method: "post",  //使用post请求到服务器获取数据
                            contentType: "application/x-www-form-urlencoded",//必须要有！！！！
                            dataType: "json",
                            cache: false,
                            url: '{% url 'test_opt' %}',
                            toolbar: '#mytab',//指定工具栏
                            striped: true,  //表格显示条纹
                            dataField: "rows",
                            pagination: true, //启动分页
                            pageSize: 10,  //每页显示的记录数
                            pageNumber: 1, //当前第几页
                            pageList: [5, 10, 15, 20, 25],  //记录数可选列表
                            // showRefresh: true,  //显示刷新按钮
                            sidePagination: "server", //表示服务端请求
                            //设置为undefined可以获取pageNumber，pageSize，searchText，sortName，sortOrder
                            //设置为limit可以获取limit, offset, search, sort, order
                            queryParamsType: "undefined",
                            clickToSelect: true,//是否启用点击选中行
                            toolbarAlign: 'left',//工具栏对齐方式
                            buttonsAlign: 'left',//按钮对齐方式
                            columns: [
                                {
                                    title: 'id',
                                    field: 'id',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false,
                                },
                                {
                                    title: '封面图',
                                    field: 'list_image',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false,
                                    formatter: function (value, row) {
                                        console.log(row)
                                        // var e1 = '<img src=' + row.list_image + '>';
                                        var e1 = '<img src="' + row.list_image + '" height="50" width="200" />';
                                        var e2 = '';
                                        if(row.list_image == ''){
                                            return e2
                                        }
                                        else{
                                            return e1
                                        }
                                    }
                                },
                                {
                                    title: '标题',
                                    field: 'title',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '来源',
                                    field: 'site_name',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '查看详情',
                                    field: 'id',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false,
                                    formatter: function (value, row) {
                                        console.log(row)
                                        var e1 = '<a href="test_opt/detail_id/' + row.id + '"> 查看详情 </a>';
                                        return e1;
                                    }
                                },
                                {
                                    title: '热点',
                                    field: 'is_hot',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '一级分类',
                                    field: 'category',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '二级分类',
                                    field: 'sub_category',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '标签',
                                    field: 'tags',
                                    align: 'center',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '作者',
                                    field: 'author',
                                    align: 'center',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: 'third_id',
                                    field: 'third_id',
                                    align: 'center',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: 'app_id',
                                    field: 'from_sources',
                                    align: 'center',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false
                                },
                                {
                                    title: '原始链接',
                                    field: 'org_url',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable: false,
                                    formatter: function (value, row) {
                                        console.log(row)
                                        var e2 = '<a href="' + row.org_url + '" target="_blank"> 查看源链接 </a>';
                                        return e2;
                                    }
                                },
                                {
                                    title: '操作',
                                    field: 'id',
                                    align: 'center',
                                    valign: 'middle',
                                    sortable:false,
                                    // 列数据格式化
                                    // formatter:operateFormatter
                                    formatter: function (value, row) {
                                        console.log(row)
                                        var e1 = '<a href="#" mce_href="#" onclick=\'id_delete("' + row.id + '")\' style="text-align: center; vertical-align: middle; "> 删除 </a>';
                                        return e1;
                                    }
                                }
                            ],
                            queryParams: function queryParams(params) {   //设置查询参数
                                var param = {
                                    //加上csrf
                                    csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),
                                    pageNumber: params.pageNumber,
                                    pageSize: params.pageSize,
                                    site_name: $("#search_name").val(),
                                    channel: $("#search_channel").val(),
                                    id: $("#search_id").val(),
                                    third_id : $('#search_third_id').val(),
                                    type: $('#atype').val(),
                                    category : $('#search_category').val(),
                                    sub_category : $('#search_sub_category').val(),
                                    app_id : $('#search_from_sources').val(),
                                    time_gt : $('#search_time_gt').val(),
                                    time_lt : $('#search_time_lt').val(),
                                    news_title : $('#search_title').val(),
                                    author : $('#search_author').val(),
                                    sort: $('#sort').val(),
                                };
                                // console.log(param)
                                return param;
                            },
                        });
                    }
                    $(document).ready(function () {
                        // 调用函数，初始化表格
                        initTable();
                    })  //important Please dont delete this function！
                    $("#search_btn").bind("click", function(){
                            // console.log('123444')
                            // console.log($('#search_id').val())
                            $('#table').bootstrapTable('refresh')
                    })
                    function id_delete(id) {
                        $.ajax({
                            url:'{% url 'id_delete' %}',
                            type:'GET',
                            dataType:'text',
                            data: {
                                'id':id,
                            },
                            success:function(result) {
                                alert(result)
                                $('#table').bootstrapTable('refresh')
                        }
                        })
                    }
                </script>
            </div>
        </div>
    </div>
</div>
</body>
</html>
